# Terminal and RGB support
set -g default-terminal "xterm-256color"
set -g default-terminal "xterm-256color"
set -ag terminal-overrides ',xterm-256color:Tc'

# set -a terminal-features "tmux-256color:RGB"
# set -g default-terminal "tmux-256color"
# set -ag terminal-overrides ',tmux-256color:Tc'

# Default: act like "inner" – prefix is C-s
set -g prefix C-s
unbind-key C-q

set -g base-index 1
set -g renumber-windows on
set -g mode-keys vi
set -g escape-time 10

# Status bar configuration
set -g status-position top
set -g status-justify absolute-centre
set -g status-style "bg=default"
set -g window-status-current-style "fg=black bg=green"
set -g status-interval 5
set -g status-right ""
set -g status 2
set -g status-format[1] ''

# Window status format
set -g window-status-format " #I #W "
set -g window-status-current-format " #I #W "

# SSH-aware status left
if-shell 'test -n "$SSH_CLIENT" || test -n "$SSH_CONNECTION"' \
    'set-option -g status-left "#[fg=yellow,bg=default] 󱩊  #H "' \
    'set-option -g status-left "#[fg=white,bg=default] 󱩊  localhost "'

# Configuration reload bindings
bind r source-file ~/.tmux.conf
bind E show-environment -g

# Vim-like pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Vim-like splits
bind-key v split-window -h
bind-key s split-window -v

# Session and window mgmt
bind-key k run-shell 'tmux switch-client -n; tmux kill-session -t "#{client_last_session}"'
bind-key q kill-pane

# Terminal title settings
set -g set-titles on
set-option -g allow-rename off

# VI mode copy settings
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle

# Mouse support and clipboard
set -g mouse on
set-option -g set-clipboard on

# This C-f binding is dynamic and context-aware.
bind-key -n C-f run-shell " \
    if ps -o comm= -t '#{pane_tty}' | grep -q ssh; then \
        # The active pane is an SSH session, so pass the C-f through.
        tmux send-keys C-f; \
    elif [ -n \"$SSH_CLIENT\" ] || [ -n \"$SSH_CONNECTION\" ]; then \
        # We are on a remote machine (but not in a nested SSH pane), so run the default sessionizer.
        tmux display-popup -w 80% -h 80% -E 'tmux-sessionizer'; \
    else \
        # We are on the local machine and in a local pane, so run the master picker.
        tmux display-popup -w 80% -h 80% -E 'tmux-sessionizer --local'; \
    fi"

# The C-Space binding is simpler: it only works on the local machine.
bind-key -n C-Space run-shell " \
    if [ -z \"$SSH_CLIENT\" ] && [ -z \"$SSH_CONNECTION\" ]; then \
        tmux display-popup -w 80% -h 80% -E 'tmux-sessionizer --local'; \
    fi"

# Theme colors
white='#dcd7ba'
gray='#2a2a37'
dark_gray='#1a1a22'
light_purple='#363646'
dark_purple='#54546D'
cyan='#6a9589'
green='#938aa9'
orange='#dca561'
red='#e46876'
pink='#d27e99'
yellow='#ff9e3b'

# Pane border styling
set-option -g pane-active-border-style "fg=${light_purple}"
set-option -g pane-border-style "fg=${gray}"
set-option -g pane-border-status bottom
set-option -g pane-border-format "#{?pane_active,#[fg=${dark_purple}],#[fg=${gray}]} ⎇#{pane_index} "
set-option -g popup-border-style "fg=${dark_purple}"

# Smart pane switching with Vim awareness
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

# Navigation bindings
bind-key -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind-key -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind-key -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind-key -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"

# Copy mode navigation
bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R
bind-key -T copy-mode-vi 'C-\' select-pane -l
bind-key -T copy-mode-vi 'C-,' select-pane -t:.+

